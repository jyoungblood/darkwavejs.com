---
/**
 * Docs navigation component with collapsible sections.
 * Dynamically loads published docs from the centralized navigation config.
 */
import { getDocsNavSections } from '../utils/navigation';
import MobileNavDropdown from './MobileNavDropdown.astro';
import NavSection from './NavSection.astro';

const sections = await getDocsNavSections();
const currentPath = Astro.url.pathname;

// Find current page title for mobile dropdown
const allEntries = sections.flatMap(s => s.entries);
const currentEntry = allEntries.find(e => currentPath === e.href || currentPath === e.href.slice(0, -1));
const currentPageTitle = currentEntry?.title || 'Navigate';
---

<!-- Mobile Dropdown Nav -->
<MobileNavDropdown id="docs" currentTitle={currentPageTitle}>
  {sections.map((section) => (
    <NavSection
      id={section.id}
      label={section.label}
      entries={section.entries}
      currentPath={currentPath}
      mobile={true}
    />
  ))}
</MobileNavDropdown>

<!-- Desktop/Tablet Nav -->
<nav class="hidden sm:block space-y-6">
  {sections.map((section) => (
    <NavSection
      id={section.id}
      label={section.label}
      entries={section.entries}
      currentPath={currentPath}
    />
  ))}
</nav>

<script>
  function initDesktopNavSections() {
    document.querySelectorAll('.nav-section-toggle').forEach(button => {
      button.addEventListener('click', () => {
        const section = button.closest('.nav-section');
        const content = section?.querySelector('.nav-section-content');
        const chevron = button.querySelector('.section-chevron');
        const isExpanded = button.getAttribute('aria-expanded') === 'true';

        if (content) {
          (content as HTMLElement).style.display = isExpanded ? 'none' : '';
        }
        if (chevron) {
          (chevron as HTMLElement).style.transform = isExpanded ? '' : 'rotate(90deg)';
        }
        button.setAttribute('aria-expanded', isExpanded ? 'false' : 'true');
      });
    });
  }

  document.addEventListener('DOMContentLoaded', initDesktopNavSections);
  document.addEventListener('astro:page-load', initDesktopNavSections);
</script>
