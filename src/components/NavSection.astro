---
/**
 * Reusable collapsible navigation section component.
 * Used by both DocsNav and FieldGuideNav for consistent behavior.
 */
import type { NavEntry } from '../utils/navigation';

interface Props {
  /** Unique identifier for the section (used for data attributes) */
  id: string;
  /** Display label for the section header */
  label: string;
  /** Navigation entries to display */
  entries: NavEntry[];
  /** Current page path for active state detection */
  currentPath: string;
  /** Whether this is a mobile view (affects styling) */
  mobile?: boolean;
  /** Whether the section should be expanded by default */
  defaultExpanded?: boolean;
}

const { id, label, entries, currentPath, mobile = false, defaultExpanded = false } = Astro.props;

function isActive(entry: NavEntry) {
  return currentPath === entry.href || currentPath === entry.href.slice(0, -1);
}

// Section is expanded if explicitly set or if current page is in this section
const isExpanded = defaultExpanded || entries.some(e => isActive(e));

// CSS classes based on mobile/desktop
const sectionClass = mobile ? 'nav-section-mobile' : 'nav-section';
const toggleClass = mobile ? 'nav-section-toggle-mobile' : 'nav-section-toggle';
const contentClass = mobile ? 'nav-section-content-mobile' : 'nav-section-content';
const chevronClass = mobile ? 'section-chevron-mobile' : 'section-chevron';
---

<div class={sectionClass} data-section={id || 'intro'}>
  <button
    class:list={[
      toggleClass,
      "w-full flex items-center justify-between font-semibold text-neutral-400 uppercase tracking-wide mb-2 hover:text-neutral-200 transition-colors",
      mobile ? "text-xs" : "text-sm"
    ]}
    type="button"
    aria-expanded={isExpanded ? "true" : "false"}
  >
    <span>{label}</span>
    <svg
      class:list={[chevronClass, "transition-transform", mobile ? "w-3 h-3" : "w-4 h-4"]}
      style={isExpanded ? "transform: rotate(90deg)" : ""}
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <path d="M9 18l6-6-6-6" />
    </svg>
  </button>
  <ul class:list={[contentClass, "space-y-1"]} style={isExpanded ? "" : "display: none"}>
    {entries.map((entry) => {
      const active = isActive(entry);
      return (
        <li>
          <a
            href={entry.href}
            class:list={[
              "block px-3 py-2 rounded text-sm transition-colors",
              active
                ? "bg-neutral-800 text-dw-green"
                : "text-neutral-400 hover:text-dw-green hover:bg-neutral-800/50 active:text-dw-green active:bg-neutral-800"
            ]}
          >
            {entry.title}
          </a>
        </li>
      );
    })}
  </ul>
</div>
